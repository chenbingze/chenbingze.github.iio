"use strict";(self["webpackChunkai_livestock_fronted"]=self["webpackChunkai_livestock_fronted"]||[]).push([[167],{56380:function(e,l,a){a.r(l),a.d(l,{default:function(){return F}});var t=a(8350),n=(a(85134),a(24907)),r=(a(40121),a(37336)),o=(a(48504),a(86660)),u=(a(28475),a(20837),a(6556)),d=(a(87228),a(88464)),s=(a(45177),a(75311)),i=(a(24971),a(77049)),p=(a(75915),a(94035)),m=(a(96152),a(39284),a(29491)),c=(a(50657),a(60096),a(66252)),g=a(49963),f=a(3577);const w={class:"app-container"},h=(0,c.Uk)("搜索"),y=(0,c.Uk)("重置"),b=(0,c.Uk)("新增"),_=(0,c.Uk)("导出"),W=["textContent"],v=(0,c.Uk)(" b "),k=(0,c.Uk)(" 编辑 "),x=(0,c.Uk)(" 删除 "),V={class:"pagination"},S={class:"dialog-footer"},C=(0,c.Uk)("取 消"),z=(0,c.Uk)("确 定");function U(e,l,a,U,T,D){const q=m.BT,P=m.km,E=s.nH,I=p.EZ,H=i.mi,Q=s.ly,j=d.dq,$=u.Dv,F=r.$Y,K=(0,c.up)("Edit"),O=o.gn,Z=(0,c.up)("Delete"),L=r.eI,Y=n.R,A=t.d0;return(0,c.wg)(),(0,c.iD)("div",null,[(0,c._)("div",w,[(0,c.Wm)(j,null,{default:(0,c.w5)((()=>[(0,c.Wm)(Q,{inline:!0,style:{float:"left"}},{default:(0,c.w5)((()=>[(0,c.Wm)(E,{label:"用户类型"},{default:(0,c.w5)((()=>[(0,c.Wm)(P,{modelValue:U.userSelectQuery.user_type,"onUpdate:modelValue":l[1]||(l[1]=e=>U.userSelectQuery.user_type=e),placeholder:"选择用户类型",style:{width:"160px"}},{default:(0,c.w5)((()=>[(0,c.Wm)(q,{key:"4",label:"全部",value:""}),((0,c.wg)(!0),(0,c.iD)(c.HY,null,(0,c.Ko)(U.userTypeList,(e=>((0,c.wg)(),(0,c.j4)(q,{key:e.type,label:e.name,value:e.type,onKeyup:l[0]||(l[0]=(0,g.D2)((e=>U.handleSearch()),["enter"]))},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,c.Wm)(E,{label:"用户名"},{default:(0,c.w5)((()=>[(0,c.Wm)(I,{modelValue:U.userSelectQuery.username,"onUpdate:modelValue":l[2]||(l[2]=e=>U.userSelectQuery.username=e),placeholder:"请输入用户名",clearable:"",style:{width:"160px"},onKeyup:l[3]||(l[3]=(0,g.D2)((e=>U.handleSearch()),["enter"]))},null,8,["modelValue"])])),_:1}),(0,c.Wm)(E,{label:"养殖场数量",prop:"farm_number"},{default:(0,c.w5)((()=>[(0,c.Wm)(I,{modelValue:U.userSelectQuery.farm_number,"onUpdate:modelValue":l[4]||(l[4]=e=>U.userSelectQuery.farm_number=e),modelModifiers:{number:!0},oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:"请输入养殖场数量",clearable:"",style:{width:"160px"},onKeyup:l[5]||(l[5]=(0,g.D2)((e=>U.handleSearch()),["enter"]))},null,8,["modelValue"])])),_:1}),(0,c.Wm)(E,null,{default:(0,c.w5)((()=>[(0,c.Wm)(H,{type:"primary",icon:"Search",onClick:l[6]||(l[6]=e=>U.handleSearch())},{default:(0,c.w5)((()=>[h])),_:1}),(0,c.Wm)(H,{icon:"Refresh",onClick:l[7]||(l[7]=e=>U.resetQuery())},{default:(0,c.w5)((()=>[y])),_:1})])),_:1})])),_:1})])),_:1}),(0,c.Wm)(j,null,{default:(0,c.w5)((()=>[(0,c.Wm)(j,{gutter:10,class:"mb8",style:{"margin-bottom":"10px"}},{default:(0,c.w5)((()=>[(0,c.Wm)($,{span:1.5},{default:(0,c.w5)((()=>[(0,c.Wm)(H,{type:"primary",plain:"",icon:"Plus",onClick:l[8]||(l[8]=e=>U.handleAdd())},{default:(0,c.w5)((()=>[b])),_:1})])),_:1},8,["span"]),(0,c.Wm)($,{span:1.5},{default:(0,c.w5)((()=>[(0,c.Wm)(H,{type:"warning",plain:"",icon:"Download",onClick:U.exportTable},{default:(0,c.w5)((()=>[_])),_:1},8,["onClick"])])),_:1},8,["span"])])),_:1})])),_:1}),(0,c.Wm)(L,{data:U.tableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header",id:"out-table"},{default:(0,c.w5)((()=>[(0,c.Wm)(F,{type:"index",label:"序号",width:"55",align:"center"},{default:(0,c.w5)((e=>[(0,c._)("span",{textContent:(0,f.zw)(U.getIndex(e.$index))},null,8,W)])),_:1}),(0,c.Wm)(F,{prop:"fields.username",label:"用户名",align:"center"}),v,(0,c.Wm)(F,{label:"用户类型",align:"center"},{default:(0,c.w5)((e=>[(0,c.Uk)((0,f.zw)(U.userTypeList.find((l=>l.type==e.row.fields.user_type)).name),1)])),_:1}),(0,c.Wm)(F,{prop:"fields.farm_number",label:"养殖场数量",align:"center",width:"100"}),(0,c.Wm)(F,{prop:"fields.enclosure_number",label:"圈舍数量",align:"center",width:"85"}),(0,c.Wm)(F,{prop:"fields.livestock_number",label:"牛只数量",align:"center",width:"85"}),(0,c.Wm)(F,{prop:"fields.necklace_number",label:"项圈数量",align:"center",width:"85"}),(0,c.Wm)(F,{prop:"fields.create_time",label:"创建时间",align:"center"}),(0,c.Wm)(F,{prop:"fields.update_time",label:"更新时间",align:"center"}),(0,c.Wm)(F,{label:"操作",width:"210",align:"center"},{default:(0,c.w5)((e=>[(0,c.Wm)(H,{type:"primary",onClick:l=>U.handleEdit(e.$index,e.row)},{default:(0,c.w5)((()=>[(0,c.Wm)(O,null,{default:(0,c.w5)((()=>[(0,c.Wm)(K)])),_:1}),k])),_:2},1032,["onClick"]),(0,c.Wm)(H,{type:"danger",onClick:l=>U.handleDelete(e.$index,e.row)},{default:(0,c.w5)((()=>[(0,c.Wm)(O,null,{default:(0,c.w5)((()=>[(0,c.Wm)(Z)])),_:1}),x])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,c._)("div",V,[(0,c.Wm)(Y,{background:"",layout:"total,sizes, prev, pager, next","current-page":U.pageParams.pageIndex,"onUpdate:current-page":l[9]||(l[9]=e=>U.pageParams.pageIndex=e),"page-size":U.pageParams.pageSize,"onUpdate:page-size":l[10]||(l[10]=e=>U.pageParams.pageSize=e),"page-sizes":[5,10,20,30,50,100],total:U.pageParams.pageTotal,onCurrentChange:U.handlePageChange,onSizeChange:U.handleSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])]),(0,c.Wm)(A,{title:U.dialogTitle,modelValue:U.dialogVisible,"onUpdate:modelValue":l[17]||(l[17]=e=>U.dialogVisible=e),width:"40%",ref:"dialog"},{footer:(0,c.w5)((()=>[(0,c._)("span",S,[(0,c.Wm)(H,{onClick:l[15]||(l[15]=e=>U.dialogVisible=!1)},{default:(0,c.w5)((()=>[C])),_:1}),(0,c.Wm)(H,{type:"primary",onClick:l[16]||(l[16]=e=>U.submitForm())},{default:(0,c.w5)((()=>[z])),_:1})])])),default:(0,c.w5)((()=>[(0,c.Wm)(Q,{"label-width":"100px","label-position":"left",style:{width:"400px","margin-left":"50px"},rules:U.rules,model:U.form,ref:"dialogForm"},{default:(0,c.w5)((()=>[(0,c.Wm)(E,{label:"用户名",prop:"username"},{default:(0,c.w5)((()=>[(0,c.Wm)(I,{modelValue:U.form.username,"onUpdate:modelValue":l[11]||(l[11]=e=>U.form.username=e),placeholder:"请输入用户名",style:{width:"200px"},class:"inline-input"},null,8,["modelValue"])])),_:1}),(0,c.Wm)(E,{label:"用户密码",prop:"password"},{default:(0,c.w5)((()=>[(0,c.Wm)(I,{modelValue:U.form.password,"onUpdate:modelValue":l[12]||(l[12]=e=>U.form.password=e),type:"password",placeholder:"请输入用户密码",style:{width:"200px"},class:"inline-input","show-password":""},null,8,["modelValue"])])),_:1}),(0,c.Wm)(E,{label:"确认密码",prop:"password2"},{default:(0,c.w5)((()=>[(0,c.Wm)(I,{modelValue:U.form.password2,"onUpdate:modelValue":l[13]||(l[13]=e=>U.form.password2=e),type:"password",placeholder:"请再次输入用户密码",style:{width:"200px"},class:"inline-input"},null,8,["modelValue"])])),_:1}),(0,c.Wm)(E,{label:"用户类型",prop:"user_type"},{default:(0,c.w5)((()=>[(0,c.Wm)(P,{modelValue:U.form.user_type,"onUpdate:modelValue":l[14]||(l[14]=e=>U.form.user_type=e),placeholder:"用户类型",style:{width:"200px"},class:"inline-input"},{default:(0,c.w5)((()=>[((0,c.wg)(!0),(0,c.iD)(c.HY,null,(0,c.Ko)(U.userTypeList,(e=>((0,c.wg)(),(0,c.j4)(q,{key:e.type,label:e.name,value:e.type},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"])])}a(21703);var T=a(36026);const D=e=>(0,T.Z)({url:"/sys/user/select",method:"POST",data:e}),q=e=>(0,T.Z)({url:"/sys/user/create",method:"POST",data:e}),P=e=>(0,T.Z)({url:"/sys/user/update",method:"PUT",data:e});var E=a(2262),I=a(45244),H=(a(50592),a(84105)),Q={name:"base_table",setup(){const e=[{type:0,name:"平台管理"},{type:1,name:"公司管理"},{type:2,name:"牧场管理"},{type:3,name:"用户"}],l=(0,E.qj)({}),a=(0,E.iH)([]);async function t(){await D(l).then((e=>{a.value=e.data})),a.value?(n.pageTotal=a.value.length,o(n.pageIndex,n.pageSize)):(n.pageTotal=0,r.value=[])}const n=(0,E.qj)({pageIndex:1,pageSize:10,pageTotal:0}),r=(0,E.iH)([]);function o(e,l){const t=(e-1)*l,n=t+l;r.value=a.value.slice(t,n)}function u(e){n.pageIndex=e,o(n.pageIndex,n.pageSize)}function d(e){n.pageSize=e,o(1,n.pageSize)}function s(e){return(n.pageIndex-1)*n.pageSize+e+1}function i(){n.pageIndex=1,t()}function p(){Object.keys(l).forEach((e=>{delete l[e]}))}const m=(e,l,a)=>{console.log("valid value",l),l?0===l.trim().length?a(new Error("请输入确认密码")):l!==y.password?a(new Error("两次密码不一致")):a():y.password?a(new Error("请输入确认密码")):a()},g=(0,E.qj)({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^\d{6,16}$/,message:"密码长度6-16位"}],password2:[{validator:m,required:!0,trigger:"blur"}]}),f=(0,E.iH)(!1),w=(0,E.iH)("");let h=0;const y=(0,E.qj)({username:"",user_type:"",password:"",password2:""}),b=(0,E.iH)(null),_=(0,E.iH)(null);function W(){for(const e in y)y[e]="";(0,c.Y3)((()=>{_.value.clearValidate()}))}function v(e){for(const l in e)""===e[l]&&delete e[l]}function k(){h=0,W(),g.password[0].required=!0,g.password2[0].required=!0,y.user_type=1,w.value="新增用户",f.value=!0}let x=-1;function V(e,l){h=1,W(),g.password[0].required=!1,g.password2[0].required=!1,w.value="编辑用户",x=e,y.username=l.fields.username,y.user_type=l.fields.user_type,y.id=l.pk,console.log("edit form content ",y),f.value=!0}function S(){_.value.validate((e=>{e?(v(y),0===h?(console.log("表单校验通过---新增"),q(y).then((e=>{"200"===e.code&&"删除成功"===e.message?I.z8.success("用户创建成功"):I.z8.error(e.message),console.log("create test:",e)})),f.value=!1):1===h&&(console.log("表单校验通过---修改"),P(y).then((e=>{"200"===e.code&&"修改成功"===e.message?I.z8.success("信息修改成功"):I.z8.error(e.message),console.log("update test:",e)})),f.value=!1)):(console.log("表单校验不通过"),I.z8.error("表单校验不通过"))}))}function C(){f.value=!1,I.z8.success(`修改第 ${x+1} 行成功`),Object.keys(y).forEach((e=>{r.value[x][e]=y[e]}))}function z(){U()}function U(){const e=document.querySelector("#out-table");if(!e)throw new Error("没获取到table DOM");const l=H.P6.table_to_book(e,{raw:!0});return(0,H.NC)(l,"export.xlsx",{type:"binary"})}return t(),{userTypeList:e,userSelectQuery:l,pageParams:n,tableData:r,dialogVisible:f,form:y,rules:g,dialog:b,dialogForm:_,dialogTitle:w,handleSearch:i,resetQuery:p,handlePageChange:u,handleSizeChange:d,getIndex:s,resetForm:W,handleAdd:k,handleDelete:handleDelete,handleEdit:V,submitForm:S,saveEdit:C,handleExport:z,exportTable:U}}},j=a(83744);const $=(0,j.Z)(Q,[["render",U],["__scopeId","data-v-7fcf0719"]]);var F=$},60096:function(e,l,a){a(56450)},50657:function(e,l,a){a(40109)}}]);