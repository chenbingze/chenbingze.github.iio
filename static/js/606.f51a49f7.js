"use strict";(self["webpackChunkai_livestock_fronted"]=self["webpackChunkai_livestock_fronted"]||[]).push([[606],{81618:function(e){(function(n,a){e.exports=a()})(0,(function(){function e(e){var o=[];return e.AMapUI&&o.push(n(e.AMapUI)),e.Loca&&o.push(a(e.Loca)),Promise.all(o)}function n(e){return new Promise((function(n,a){var c=[];if(e.plugins)for(var s=0;s<e.plugins.length;s+=1)-1==l.AMapUI.plugins.indexOf(e.plugins[s])&&c.push(e.plugins[s]);if(t.AMapUI===o.failed)a("前次请求 AMapUI 失败");else if(t.AMapUI===o.notload){t.AMapUI=o.loading,l.AMapUI.version=e.version||l.AMapUI.version,s=l.AMapUI.version;var r=document.body||document.head,d=document.createElement("script");d.type="text/javascript",d.src="https://webapi.amap.com/ui/"+s+"/main.js",d.onerror=function(e){t.AMapUI=o.failed,a("请求 AMapUI 失败")},d.onload=function(){if(t.AMapUI=o.loaded,c.length)window.AMapUI.loadUI(c,(function(){for(var e=0,a=c.length;e<a;e++){var o=c[e].split("/").slice(-1)[0];window.AMapUI[o]=arguments[e]}for(n();i.AMapUI.length;)i.AMapUI.splice(0,1)[0]()}));else for(n();i.AMapUI.length;)i.AMapUI.splice(0,1)[0]()},r.appendChild(d)}else t.AMapUI===o.loaded?e.version&&e.version!==l.AMapUI.version?a("不允许多个版本 AMapUI 混用"):c.length?window.AMapUI.loadUI(c,(function(){for(var e=0,a=c.length;e<a;e++){var o=c[e].split("/").slice(-1)[0];window.AMapUI[o]=arguments[e]}n()})):n():e.version&&e.version!==l.AMapUI.version?a("不允许多个版本 AMapUI 混用"):i.AMapUI.push((function(e){e?a(e):c.length?window.AMapUI.loadUI(c,(function(){for(var e=0,a=c.length;e<a;e++){var o=c[e].split("/").slice(-1)[0];window.AMapUI[o]=arguments[e]}n()})):n()}))}))}function a(e){return new Promise((function(n,a){if(t.Loca===o.failed)a("前次请求 Loca 失败");else if(t.Loca===o.notload){t.Loca=o.loading,l.Loca.version=e.version||l.Loca.version;var c=l.Loca.version,s=l.AMap.version.startsWith("2"),r=c.startsWith("2");if(s&&!r||!s&&r)a("JSAPI 与 Loca 版本不对应！！");else{s=l.key,r=document.body||document.head;var d=document.createElement("script");d.type="text/javascript",d.src="https://webapi.amap.com/loca?v="+c+"&key="+s,d.onerror=function(e){t.Loca=o.failed,a("请求 AMapUI 失败")},d.onload=function(){for(t.Loca=o.loaded,n();i.Loca.length;)i.Loca.splice(0,1)[0]()},r.appendChild(d)}}else t.Loca===o.loaded?e.version&&e.version!==l.Loca.version?a("不允许多个版本 Loca 混用"):n():e.version&&e.version!==l.Loca.version?a("不允许多个版本 Loca 混用"):i.Loca.push((function(e){e?a(e):a()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var o;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(o||(o={}));var l={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},t={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},i={AMap:[],AMapUI:[],Loca:[]},c=[],s=function(e){"function"==typeof e&&(t.AMap===o.loaded?e(window.AMap):c.push(e))};return{load:function(n){return new Promise((function(a,i){if(t.AMap==o.failed)i("");else if(t.AMap==o.notload){var r=n.key,d=n.version,u=n.plugins;r?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),l.key=r,l.AMap.version=d||l.AMap.version,l.AMap.plugins=u||l.AMap.plugins,t.AMap=o.loading,d=document.body||document.head,window.___onAPILoaded=function(l){if(delete window.___onAPILoaded,l)t.AMap=o.failed,i(l);else for(t.AMap=o.loaded,e(n).then((function(){a(window.AMap)}))["catch"](i);c.length;)c.splice(0,1)[0]()},u=document.createElement("script"),u.type="text/javascript",u.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+l.AMap.version+"&key="+r+"&plugin="+l.AMap.plugins.join(","),u.onerror=function(e){t.AMap=o.failed,i(e)},d.appendChild(u)):i("请填写key")}else if(t.AMap==o.loaded)if(n.key&&n.key!==l.key)i("多个不一致的 key");else if(n.version&&n.version!==l.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(r=[],n.plugins)for(d=0;d<n.plugins.length;d+=1)-1==l.AMap.plugins.indexOf(n.plugins[d])&&r.push(n.plugins[d]);r.length?window.AMap.plugin(r,(function(){e(n).then((function(){a(window.AMap)}))["catch"](i)})):e(n).then((function(){a(window.AMap)}))["catch"](i)}else if(n.key&&n.key!==l.key)i("多个不一致的 key");else if(n.version&&n.version!==l.AMap.version)i("不允许多个版本 JSAPI 混用");else{var p=[];if(n.plugins)for(d=0;d<n.plugins.length;d+=1)-1==l.AMap.plugins.indexOf(n.plugins[d])&&p.push(n.plugins[d]);s((function(){p.length?window.AMap.plugin(p,(function(){e(n).then((function(){a(window.AMap)}))["catch"](i)})):e(n).then((function(){a(window.AMap)}))["catch"](i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,l={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},t={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},i={AMap:[],AMapUI:[],Loca:[]}}}}))},89341:function(e,n,a){a.d(n,{O:function(){return l}});var o=a(36026);const l=e=>(0,o.Z)({url:"/farmowner/select",method:"POST",data:e})},57606:function(e,n,a){a.r(n),a.d(n,{default:function(){return z}});var o=a(75311),l=(a(24971),a(39284),a(94035)),t=(a(96152),a(77049)),i=(a(75915),a(88464)),c=(a(45177),a(29491)),s=(a(50657),a(60096),a(66252)),r=a(3577);const d=e=>((0,s.dD)("data-v-e2f82386"),e=e(),(0,s.Cn)(),e),u=d((()=>(0,s._)("span",{class:"top"},"牧场名称：",-1))),p={id:"mapContainer"},f={key:0,class:"newFence"},v=(0,s.Uk)("新建放牧区"),h={key:1,class:"drawtool"},g=d((()=>(0,s._)("span",null,"鼠标左键点击及移动即可绘制图形",-1))),w=d((()=>(0,s._)("br",null,null,-1))),A=d((()=>(0,s._)("span",null,"右键单击停止绘制",-1))),M=(0,s.Uk)("清空绘制"),m=(0,s.Uk)("取消绘制"),y=(0,s.Uk)("保存"),k={key:2,class:"test"},I={class:"test2"},U=(0,s.Uk)("删除");function F(e,n,a,d,F,C){const L=c.BT,_=c.km,b=i.dq,P=t.mi,x=l.EZ,O=o.nH,W=o.ly;return(0,s.wg)(),(0,s.iD)("div",null,[(0,s.Wm)(b,null,{default:(0,s.w5)((()=>[u,(0,s.Wm)(_,{modelValue:d.createFenceQuery.farm,"onUpdate:modelValue":n[0]||(n[0]=e=>d.createFenceQuery.farm=e),onChange:d.onOptionChanged,placeholder:"选择养殖场",style:{width:"160px"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(d.farmList,(e=>((0,s.wg)(),(0,s.j4)(L,{key:e.pk,label:e.fields.name,value:e.pk},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,s._)("div",p,[d.createFlag?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",f,[(0,s.Wm)(P,{type:"primary",disabled:d.selectFarmFlag,onClick:n[1]||(n[1]=e=>d.handleCreateFence(1)),style:{width:"88px"}},{default:(0,s.w5)((()=>[v])),_:1},8,["disabled"])])),d.createFlag?((0,s.wg)(),(0,s.iD)("div",h,[(0,s.Wm)(W,{ref:"formRef",model:d.createFenceQuery,"label-width":"100px"},{default:(0,s.w5)((()=>[g,w,A,(0,s.Wm)(O,{label:"围栏名称",prop:"name",rules:[{required:!0,message:"请输入围栏名称"}]},{default:(0,s.w5)((()=>[(0,s.Wm)(x,{modelValue:d.createFenceQuery.name,"onUpdate:modelValue":n[2]||(n[2]=e=>d.createFenceQuery.name=e),type:"text",style:{width:"150px"}},null,8,["modelValue"])])),_:1}),(0,s.Wm)(P,{type:"danger",onClick:n[3]||(n[3]=e=>d.handleClearPolygon()),style:{width:"88px"}},{default:(0,s.w5)((()=>[M])),_:1}),(0,s.Wm)(P,{type:"warning",onClick:n[4]||(n[4]=e=>d.handleCancelDraw()),style:{width:"88px"}},{default:(0,s.w5)((()=>[m])),_:1}),(0,s.Wm)(P,{type:"primary",disabled:d.saveFlag,onClick:n[5]||(n[5]=e=>d.handleSavePolygon()),style:{width:"88px"}},{default:(0,s.w5)((()=>[y])),_:1},8,["disabled"])])),_:1},8,["model"])])):(0,s.kq)("",!0),d.showFenceCard?((0,s.wg)(),(0,s.iD)("div",k,[(0,s._)("div",I,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(d.fenceList,((e,n)=>((0,s.wg)(),(0,s.iD)("div",{class:"test3",key:n},[(0,s._)("span",null,(0,r.zw)(e.fields.name),1),(0,s.Wm)(P,{link:"",type:"danger",icon:"Delete",onClick:n=>d.handleDeleteFence(e.pk)},{default:(0,s.w5)((()=>[U])),_:2},1032,["onClick"])])))),128))])])):(0,s.kq)("",!0)])])}var C=a(2262),L=a(81618),_=a.n(L),b=a(89341),P=a(36026);const x=e=>(0,P.Z)({url:"/virualfence/create",method:"POST",data:e}),O=e=>(0,P.Z)({url:"/virualfence/select",method:"POST",data:e}),W=e=>(0,P.Z)({url:"/virualfence/delete",method:"POST",data:e});var D=a(45244);const E={strokeColor:"#1E9FFF",strokeWeight:2,strokeStyle:"dashed",strokeOpacity:1,fillOpacity:.1,fillColor:"#1E9FFF",zIndex:50};var S={setup(){const e=(0,C.XI)(null),n=(0,C.iH)(!0),a=(0,C.iH)(!1),o=(0,C.iH)(!0),l=(0,C.iH)(!1),t=(0,C.iH)(null),i=(0,C.iH)([]),c=(0,C.iH)({}),r=(0,C.iH)([]),d=(0,C.iH)({});let u=null,p=null;let f=null;async function v(){await(0,b.O)().then((e=>{i.value=e.data}))}async function h(){await x(c.value).then((e=>{console.log("创建围栏回调：",e.data),g()}))}async function g(){await O(d.value).then((e=>{r.value=e.data,console.log("fence list",r.value)}))}function w(e){n.value=!1,l.value=!0,d.value.farm=e,g().then((()=>{A()}))}function A(){e.value.clearMap(),r.value.forEach((n=>{const a=F(n.fields.polygon);e.value.add(new u.Polygon({path:a,strokeColor:"#1E9FFF",strokeWeight:2,strokeStyle:"dashed",strokeOpacity:1,fillOpacity:.1,fillColor:"#1E9FFF",zIndex:50}))}))}function M(){_().load({key:"27adc4106b70fb282c08cfb77548785a",version:"2.0",plugins:["AMap.MouseTool"]}).then((n=>{u=n,e.value=new u.Map("mapContainer",{viewMode:"3D",zoom:14,center:[108.071932,34.284128]}),p=new u.MouseTool(e.value),p.on("draw",(function(e){y(e.obj.getPath()),p.close(!0)}))})).catch((e=>{console.log(e)}))}function m(e){a.value=!0,o.value=!0,p.polygon(E)}function y(n){const a=[];n.forEach((e=>{a.push([e.lng,e.lat])})),f=new u.Polygon({path:a,strokeColor:"#1E9FFF",strokeWeight:2,strokeStyle:"dashed",strokeOpacity:1,fillOpacity:.1,fillColor:"#1E9FFF",zIndex:50}),e.value.add(f);const l=a.map((e=>e.join(","))),t=l.join(";");console.log("currentPath string",t),c.value.polygon=t,o.value=!1}function k(){e.value.remove(f),p.polygon(E)}function I(){console.log("createFenceQuery",c.value),h(c),a.value=!1}function U(){try{e.value.remove(f)}catch(n){console.log("cancel error:",n)}p.close(!0),a.value=!1}function F(e){const n=e.split(";"),a=[];return n.forEach((e=>{const[n,o]=e.split(",");a.push([parseFloat(n),parseFloat(o)])})),a}function L(e){W({id:e}).then((e=>{console.log("删除回调：",e.data),"200"===e.code&&"删除成功"===e.message?(D.z8.success(e.message),g().then((()=>{A()}))):D.z8.error("删除失败")}))}return window._AMapSecurityConfig={securityJsCode:"1ef06a21c2bad86281c3e75ba84df476"},(0,s.bv)((()=>{M()})),v(),{map:e,selectFarmFlag:n,createFlag:a,saveFlag:o,showFenceCard:l,farmList:i,fenceList:r,formRef:t,createFenceQuery:c,onOptionChanged:w,handleCreateFence:m,handleDeleteFence:L,handleClearPolygon:k,handleSavePolygon:I,handleCancelDraw:U}}},H=a(83744);const j=(0,H.Z)(S,[["render",F],["__scopeId","data-v-e2f82386"]]);var z=j},75915:function(e,n,a){a(235)},39284:function(e,n,a){a(3392)},24971:function(e,n,a){a(3392)},96152:function(e,n,a){a(93979)},93979:function(e,n,a){a(3392)},60096:function(e,n,a){a(56450)},56450:function(e,n,a){a(3392)},45177:function(e,n,a){a(3392)},81748:function(e,n,a){a(3392)},50657:function(e,n,a){a(40109)},40109:function(e,n,a){a(3392),a(93979),a(45705),a(56450),a(81748),a(30942)},45705:function(e,n,a){a(3392)}}]);