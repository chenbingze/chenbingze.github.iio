"use strict";(self["webpackChunkai_livestock_fronted"]=self["webpackChunkai_livestock_fronted"]||[]).push([[389],{37708:function(e,o,t){t.d(o,{BA:function(){return c},Hg:function(){return i},K:function(){return l},Sg:function(){return n},oE:function(){return a}});var s=t(36026);const n=e=>(0,s.Z)({url:"/company/select",method:"POST",data:e}),i=e=>(0,s.Z)({url:"/company/delete",method:"POST",data:e}),c=e=>(0,s.Z)({url:"/company/create",method:"POST",data:e}),l=e=>(0,s.Z)({url:"/company/update",method:"PUT",data:e}),a=e=>(0,s.Z)({url:"/camera/user/watch",method:"POST",data:e})},94389:function(e,o,t){t.r(o),t.d(o,{default:function(){return f}});var s=t(88464),n=(t(45177),t(94035)),i=(t(96152),t(6556)),c=(t(87228),t(29491)),l=(t(50657),t(60096),t(66252));const a=e=>((0,l.dD)("data-v-c50e073a"),e=e(),(0,l.Cn)(),e),d=a((()=>(0,l._)("span",{class:"top"},"牲畜列表：",-1))),r=a((()=>(0,l._)("span",{class:"top"},"摄像头列表：",-1))),u=a((()=>(0,l._)("span",{class:"top"},"播放的视频：",-1))),k=["src"];function m(e,o,t,a,m,h){const w=c.BT,g=c.km,b=i.Dv,p=n.EZ,v=s.dq;return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l.Wm)(b,{span:6},{default:(0,l.w5)((()=>[d,(0,l.Wm)(g,{modelValue:m.necklaceId,"onUpdate:modelValue":o[0]||(o[0]=e=>m.necklaceId=e),placeholder:"选择牲畜",style:{width:"160px"},onChange:h.initWebSocket},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{key:"0",label:"全部",value:""}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(m.necklaceList,(e=>((0,l.wg)(),(0,l.j4)(w,{key:e.livestockId,label:e.livestockId,value:e.necklaceId},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,l.Wm)(b,{span:6},{default:(0,l.w5)((()=>[r,(0,l.Wm)(g,{placeholder:"选择摄像头",style:{width:"160px"},onChange:h.getVideo},null,8,["onChange"])])),_:1}),(0,l.Wm)(b,{span:6},{default:(0,l.w5)((()=>[u,(0,l.Wm)(p,{modelValue:m.videoId,"onUpdate:modelValue":o[1]||(o[1]=e=>m.videoId=e),style:{width:"160px"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l._)("img",{src:m.imgsrc,style:{width:"800px,height:600px"}},null,8,k)])),_:1})],64)}t(21703);var h=t(36026);const w=e=>(0,h.Z)({url:"/adopt/user/select",method:"POST",data:e});var g=t(37708);const b=/[`{}"\s]/g;var p={name:"livestockVideo",data(){return{necklaceId:"",myLivestockList:[],necklaceList:[],websock:null,videoId:"",websock_img:null,imgsrc:""}},watch:{videoId(e){e&&this.getVideo()}},methods:{initWebSocket(){const e="ws://10.131.155.158:8188/clientType?web?contentType?coordinate?deviceId?uwb"+this.necklaceId;console.log(e),this.websock=new WebSocket(e),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonopen(){console.log("uwb websocket Connection open ...")},websocketonerror(){this.initWebSocket()},websocketonmessage(e){this.blobToBase64(e.data).then((e=>{const[o,t,s]=e.replace(b,"").split(","),n={name:o.split(":")[1],x:t.split(":")[1],y:s.split(":")[1],z:0};n.x<400&&n.y<300?this.videoId=3:n.x>400&&n.y<300?this.videoId=2:n.x>400&&n.y>300?this.videoId=4:this.videoId=1,console.log(this.videoId)}))},websocketclose(e){console.log("断开连接",e)},blobToBase64(e){return new Promise(((o,t)=>{const s=new FileReader;s.onload=e=>{o(e.target.result)},s.readAsText(e),s.onerror=()=>{t(new Error("文件流异常"))}}))},async getMyLivestockList(){await w().then((e=>{this.myLivestockList=e.data,this.myLivestockList.forEach((e=>{this.necklaceList.push({livestockId:e.livestock.id,necklaceId:e.livestock.necklace})}))}))},getVideo(){this.websock_img&&this.websock_img.close(),this.initWebSocket_img(),console.log("现在调度的是",this.videoId,"号摄像头")},initWebSocket_img(){const e=this.myLivestockList.find((e=>e.necklace.id===this.necklaceId)).livestock.enclosure;console.log("tempEnclosureId",e);const o="ws://10.131.155.158:8188/clientType?web?contentType?image?deviceId?camera"+this.videoId;console.log(o),this.websock_img=new WebSocket(o),this.websock_img.onmessage=this.websocketonmessage_img,this.websock_img.onopen=this.websocketonopen_img,this.websock_img.onerror=this.websocketonerror_img,this.websock_img.onclose=this.websocketclose_img},websocketonopen_img(){console.log("image websocket Connection open ...")},websocketonerror_img(){this.initWebSocket_img()},websocketonmessage_img(e,o){console.log("image receive",e.data);const t=new Blob([e.data],{type:"image/jpeg"});this.imgsrc=window.URL.createObjectURL(t)},websocketsend_img(e){},websocketclose_img(e){console.log("断开连接",e)}},created(){this.getMyLivestockList(),setTimeout((()=>{(0,g.oE)({id:2,order:1})}),200),setTimeout((()=>{(0,g.oE)({id:2,order:2})}),400),setTimeout((()=>{(0,g.oE)({id:2,order:3})}),600),setTimeout((()=>{(0,g.oE)({id:2,order:4})}),800)},beforeUnmount(){this.websock.close(),this.websock_img.close()}},v=t(83744);const _=(0,v.Z)(p,[["render",m],["__scopeId","data-v-c50e073a"]]);var f=_},87228:function(e,o,t){t(3392)},96152:function(e,o,t){t(93979)},93979:function(e,o,t){t(3392)},60096:function(e,o,t){t(56450)},56450:function(e,o,t){t(3392)},45177:function(e,o,t){t(3392)},81748:function(e,o,t){t(3392)},50657:function(e,o,t){t(40109)},40109:function(e,o,t){t(3392),t(93979),t(45705),t(56450),t(81748),t(30942)},45705:function(e,o,t){t(3392)}}]);